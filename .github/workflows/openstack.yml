on: [push]

env:
  TF_VAR_user: ${{ secrets.OS_USERNAME }}
  TF_VAR_application_credential_id: ${{ secrets.OS_APPLICATION_CREDENTIAL_ID }}
  TF_VAR_application_credential_secret: ${{ secrets.OS_APPLICATION_CREDENTIAL_SECRET }}
  TF_VAR_ssh_access_key: ${{ secrets.OS_SSH_KEY }}
  TF_VAR_os_auth_region: ${{ secrets.OS_AUTH_REGION }}
  TF_VAR_os_auth_url: ${{ secrets.OS_AUTH_URL }}
  TF_VAR_os_project_domain_name: ${{ secrets.OS_PROJECT_DOMAIN_NAME }}
  TF_VAR_os_password: ${{ secrets.OS_PASSWORD }}

jobs: 
    init_terraform:
        runs-on: self-hosted
        name: Terraform
        run:
          working-directory: "./.github/workflows/openstack/terraform"
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Setup Terraform
              uses: hashicorp/setup-terraform@v3
              with:
                terraform_version: "1.8.3"
            - run: terraform init
            - id: plan
              run: terraform plan -no-color
            - run: echo ${{ steps.plan.outputs.stdout }}
            - run: echo ${{ steps.plan.outputs.stderr }}
            - run: echo ${{ steps.plan.outputs.exitcode }}

